{% extends "base.html" %}

{% block content %}

<form action="{{ request.url }}" method="post">

<h1>{{ name }}{% if name %}'s{% endif %} Ballot Preview</h1>

<p>{{ election['name'] }} ({{ election['date'] }})</p>

<p>
    {{ precinct['county'] }} County,
    {{ precinct['jurisdiction'] }},

    {% if precinct['ward'] %}
    Ward {{ precinct['ward' ]}},
    {% endif %}

    {% if precinct['number'] %}
    Precinct {{ precinct['number'] }}
    {% endif %}
</p>

<p>
(<a href="{{ url_for('election', election_id=election['id']) }}">find your own ballot</a>)
</p>

<div>
<h2>Positions</h2>

{% for position in positions %}
    {% set position_key = 'position-' + position['id']|string %}

    <div class="ml-4">
        <h3>{{ position['name'] }}</h3>

        <div class="ml-4">
            <i class="text-muted">
            District: {{ position['district']['name'] }}
            {% if position['district']['category'] != "State" %}
            {{ position['district']['category'] }}
            {% endif %}

            <br>

            Reference URL:
            <a href="{{ position['reference_url'] }}">{{ position['reference_url'] or '' }}</a>

            <br>

            Description: {{ position['description'] }}

            <br>

            Seats: {{ position['seats'] }}
            </i>

            <h4>Candidates</h4>

            <div class="ml-4">
            {% for candidate in position['candidates'] %}
                {% set candidate_key = 'candidate-' + candidate['id']|string %}

                <div class="form-check">
                    <input class="form-check-input"
                           type={% if position['seats'] == 1%}"radio"{% else %}"checkbox"{% endif %}
                           name="{{ position_key }}"
                           value="{{ candidate_key }}"
                           onChange="document.getElementById('save-toolbar').style.removeProperty('display');"
                           {% if candidate_key in votes[position_key] %}checked{% endif %}>
                    <label class="form-check-label"
                           for="{{ position_key }}">
                        {{ candidate['name'] }} ({{ candidate['party']['name'] }})
                    </label>
                </div>

            {% endfor %}
            </div>

        </div>
    </div>
{% endfor %}
</div>

<div>
<h2>Proposals</h2>

{% for proposal in proposals %}
    {% set proposal_key = 'proposal-' + proposal['id']|string %}

    <div class="ml-4">
        <h3>{{ proposal['name'] }}</h3>

        <div class="ml-4">
            <i class="text-muted">
            District: {{ proposal['district']['name'] }}
            {% if proposal['district']['category'] != "State" %}
            {{ proposal['district']['category'] }}
            {% endif %}

            <br>

            Reference URL:
            <a href="{{ proposal['reference_url'] }}">{{ proposal['reference_url'] or '' }}</a>
            </i>

            <p>{{ proposal['description'] }}</p>

            <h4>Approve</h4>

            <div class="ml-4">

                <div class="form-check">
                    <input class="form-check-input"
                           type="radio"
                           name="{{ proposal_key }}"
                           value="yes"
                           onChange="document.getElementById('save-toolbar').style.removeProperty('display');"
                           {% if votes[proposal_key] == 'yes' %}checked{% endif %}>
                    <label class="form-check-label" for="{{ proposal_key }}">
                        Yes
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input"
                           type="radio"
                           name="{{ proposal_key }}"
                           value="no"
                           onChange="document.getElementById('save-toolbar').style.removeProperty('display');"
                           {% if votes[proposal_key] == 'no' %}checked{% endif %}>
                    <label class="form-check-label" for="{{ proposal_key }}">
                        No
                    </label>
                </div>

            </div>

        </div>
    </div>
{% endfor %}
</div>

<div id="save-toolbar" style="display: none;">
<br><br>
<div class="py-3 fixed-bottom text-center bg-dark">
    <button type="submit" class="btn btn-primary">Save Ballot Changes</button>
</div>
</div>

</form>

{% endblock %}
